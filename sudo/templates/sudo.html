<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>Sudo</title>

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>

        <script type="text/javascript" charset="utf-8">
            $(function() {
                var busy = '<center><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></center>';
                var free = '<center><span class="glyphicon glyphicon-ok" aria-hidden="true"></span></center>';
                var content = '<table class="table table-bordered table-hover">';
                var ct = 1;
                var sta = [];
                var ss = ['1', '2', '3', '4', 'n', '5', '6', '7', '8', '9', 'a', 'b', 'c'];
                var week = ['禮拜一', '禮拜二', '禮拜三', '禮拜四', '禮拜五', '禮拜六', '禮拜天'];
                content += '<tr><th></th>';
                for (var i = 0; i < 7; i++) {
                    content += '<th><center>'+week[i]+'</center></th>';
                }
                content += '</tr>';
                var dbsta = $('#schedule').val();
                for (var i = 0; i < 100; i++) {
                    sta[i] = dbsta[i];
                }
                for (var i = 1; i <= 13; i++) {
                    content += '<tr>';
                    content += '<td><center>'+ss[i-1]+'</center></td>';
                    for (var j = 1; j <= 7; j++) {
                        content += ('<td class="time" id=' + ct + '>');
                        content += free;
                        content += '</td>';
                        ct++;
                    }
                    content += '</tr>';
                }
                content += '</table>';
                console.log(content);
                $("#timetable").html(content);
                $(".time").click(function(){
                    console.log($(this).attr('id'));
                    target = $(this).attr('id');
                    if (sta[target] == '0') {
                        sta[target] = '1';
                        target = "#"+target;
                        $(target).html(busy);
                    } else {
                        sta[target] = '0';
                        target = "#"+target;
                        $(target).html(free);
                    }
                    var outSta = "";
                    for (var i = 1; i <= 13*7; i++) {
                        outSta += sta[i];
                    }
                    $('#schedule').val(outSta);
                });
                $('#done').click(function(){
                    var pstr = $('#rawData').val();
                    var queK1 = ['M', 'T', 'W', 'R', 'F', 'S'];
                    for (var i = 0; i < 6; i++) {
                        for (var j = 0; j < 13; j++) {
                            key = '/'+queK1[i]+ss[j]+'/';
                            ind = pstr.search(key);
                            if (ind != -1) {
                                sta[j*7+i+1] = '1';
                            } else {
                                sta[j*7+i+1] = '0';
                            }
                        }
                    }
                });
            });
        </script>
    </head>
    <body class="container">
        {{form}}
        <input type="text" name="rawData" id="rawData" value="Pusheen meow~" />
        <button id="done">Sent Table!</button>
        <div id="timetable">
        </div>
    </body>
</html>
